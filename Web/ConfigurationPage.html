<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>JellyScout Configuration</title>
</head>
<body>
    <div data-role="page" class="page type-interior configurationPage" data-require="emby-input,emby-button,emby-select,emby-checkbox">
        <div data-role="content">
            <div class="content-primary">
                <form id="jellyscoutConfigForm" class="esqConfigurationForm">
                    <div class="verticalSection verticalSection-extrabottompadding">
                        <div class="sectionTitleContainer flex align-items-center">
                            <h2 class="sectionTitle">JellyScout Configuration</h2>
                        </div>
                        
                        <div class="checkboxContainer">
                            <label class="emby-checkbox-label">
                                <input type="checkbox" is="emby-checkbox" id="EnableStreaming" name="EnableStreaming" data-embycheckbox="true" class="emby-checkbox">
                                <span class="checkboxLabel">Enable Streaming</span>
                                <span class="checkboxOutline"><span class="material-icons checkboxIcon checkboxIcon-checked check" aria-hidden="true"></span><span class="material-icons checkboxIcon checkboxIcon-unchecked" aria-hidden="true"></span></span>
                            </label>
                            <div class="fieldDescription">Allow users to stream content directly from torrents</div>
                        </div>
                        
                        <div class="checkboxContainer">
                            <label class="emby-checkbox-label">
                                <input type="checkbox" is="emby-checkbox" id="EnableDownloads" name="EnableDownloads" data-embycheckbox="true" class="emby-checkbox">
                                <span class="checkboxLabel">Enable Downloads</span>
                                <span class="checkboxOutline"><span class="material-icons checkboxIcon checkboxIcon-checked check" aria-hidden="true"></span><span class="material-icons checkboxIcon checkboxIcon-unchecked" aria-hidden="true"></span></span>
                            </label>
                            <div class="fieldDescription">Allow users to download content via external services</div>
                        </div>
                        
                        <div class="inputContainer">
                            <label class="inputLabel inputLabelUnfocused" for="TmdbApiKey">TMDB API Key:</label>
                            <input is="emby-input" type="text" id="TmdbApiKey" name="TmdbApiKey" label="TMDB API Key:" class="emby-input">
                            <div class="fieldDescription">Get your free API key from <a href="https://www.themoviedb.org/settings/api" target="_blank">TMDB</a></div>
                        </div>
                        
                        <div class="inputContainer">
                            <label class="inputLabel inputLabelUnfocused" for="MaxSearchResults">Max Search Results:</label>
                            <input is="emby-input" type="number" id="MaxSearchResults" name="MaxSearchResults" min="10" max="100" label="Max Search Results:" class="emby-input">
                            <div class="fieldDescription">Maximum number of search results to return (10-100)</div>
                        </div>
                        
                        <div class="selectContainer">
                            <label class="selectLabel" for="DefaultQuality">Default Quality:</label>
                            <select is="emby-select" id="DefaultQuality" name="DefaultQuality" label="Default Quality:" class="emby-select-withcolor emby-select">
                                <option value="480p">480p</option>
                                <option value="720p">720p</option>
                                <option value="1080p">1080p</option>
                                <option value="4K">4K</option>
                            </select>
                            <div class="selectArrowContainer"><div style="visibility:hidden;display:none;">0</div><span class="selectArrow material-icons keyboard_arrow_down" aria-hidden="true"></span></div>
                            <div class="fieldDescription">Default quality preference for streaming and downloads</div>
                        </div>
                        
                        <h3 class="sectionTitle">External Services</h3>
                        
                        <div class="inputContainer">
                            <label class="inputLabel inputLabelUnfocused" for="SonarrServerUrl">Sonarr Server URL:</label>
                            <input is="emby-input" type="text" id="SonarrServerUrl" name="SonarrServerUrl" placeholder="http://localhost:8989" label="Sonarr Server URL:" class="emby-input">
                            <div class="fieldDescription">URL of your Sonarr instance (optional)</div>
                        </div>
                        
                        <div class="inputContainer">
                            <label class="inputLabel inputLabelUnfocused" for="SonarrApiKey">Sonarr API Key:</label>
                            <input is="emby-input" type="text" id="SonarrApiKey" name="SonarrApiKey" label="Sonarr API Key:" class="emby-input">
                            <div class="fieldDescription">Found in Sonarr Settings > General > Security (optional)</div>
                        </div>
                        
                        <div class="inputContainer">
                            <label class="inputLabel inputLabelUnfocused" for="RadarrServerUrl">Radarr Server URL:</label>
                            <input is="emby-input" type="text" id="RadarrServerUrl" name="RadarrServerUrl" placeholder="http://localhost:7878" label="Radarr Server URL:" class="emby-input">
                            <div class="fieldDescription">URL of your Radarr instance (optional)</div>
                        </div>
                        
                        <div class="inputContainer">
                            <label class="inputLabel inputLabelUnfocused" for="RadarrApiKey">Radarr API Key:</label>
                            <input is="emby-input" type="text" id="RadarrApiKey" name="RadarrApiKey" label="Radarr API Key:" class="emby-input">
                            <div class="fieldDescription">Found in Radarr Settings > General > Security (optional)</div>
                        </div>
                        
                        <h3 class="sectionTitle">Streaming Services</h3>
                        
                        <div class="inputContainer">
                            <label class="inputLabel inputLabelUnfocused" for="ProwlarrServerUrl">Prowlarr Server URL:</label>
                            <input is="emby-input" type="text" id="ProwlarrServerUrl" name="ProwlarrServerUrl" placeholder="http://localhost:9696" label="Prowlarr Server URL:" class="emby-input">
                            <div class="fieldDescription">URL of your Prowlarr instance for torrent search</div>
                        </div>
                        
                        <div class="inputContainer">
                            <label class="inputLabel inputLabelUnfocused" for="ProwlarrApiKey">Prowlarr API Key:</label>
                            <input is="emby-input" type="text" id="ProwlarrApiKey" name="ProwlarrApiKey" label="Prowlarr API Key:" class="emby-input">
                            <div class="fieldDescription">Found in Prowlarr Settings > General > Security (for streaming)</div>
                        </div>
                        
                        <div class="inputContainer">
                            <label class="inputLabel inputLabelUnfocused" for="MinSeeders">Minimum Seeders for Streaming:</label>
                            <input is="emby-input" type="number" id="MinSeeders" name="MinSeeders" min="1" max="100" label="Minimum Seeders for Streaming:" class="emby-input">
                            <div class="fieldDescription">Minimum number of seeders required to show streaming option</div>
                        </div>
                        
                        <div class="inputContainer">
                            <label class="inputLabel inputLabelUnfocused" for="BitPlayServerUrl">BitPlay Server URL:</label>
                            <input is="emby-input" type="text" id="BitPlayServerUrl" name="BitPlayServerUrl" placeholder="http://localhost:3347" label="BitPlay Server URL:" class="emby-input">
                            <div class="fieldDescription">URL of your BitPlay streaming server</div>
                        </div>
                        
                        <div class="checkboxContainer">
                            <label class="emby-checkbox-label">
                                <input type="checkbox" is="emby-checkbox" id="EnableNotifications" name="EnableNotifications" data-embycheckbox="true" class="emby-checkbox">
                                <span class="checkboxLabel">Enable Notifications</span>
                                <span class="checkboxOutline"><span class="material-icons checkboxIcon checkboxIcon-checked check" aria-hidden="true"></span><span class="material-icons checkboxIcon checkboxIcon-unchecked" aria-hidden="true"></span></span>
                            </label>
                            <div class="fieldDescription">Show real-time notifications for downloads and streaming</div>
                        </div>
                        
                        <div>
                            <button is="emby-button" type="submit" data-theme="b" class="raised button-submit block emby-button">
                                <span>Save</span>
                            </button>
                            <button is="emby-button" type="button" class="raised button-cancel block btnCancel emby-button" onclick="history.back();">
                                <span>Cancel</span>
                            </button>
                        </div>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <script type="text/javascript">
        function loadPage() {
            Dashboard.showLoadingMsg();
            
            // Load plugin configuration
            ApiClient.getPluginConfiguration(JellyScoutConfigurationPage.pluginId).then(function(config) {
                
                // Load form values
                document.getElementById('EnableStreaming').checked = config.EnableStreaming || false;
                document.getElementById('EnableDownloads').checked = config.EnableDownloads || false;
                document.getElementById('TmdbApiKey').value = config.TmdbApiKey || '';
                document.getElementById('MaxSearchResults').value = config.MaxSearchResults || 50;
                document.getElementById('DefaultQuality').value = config.DefaultQuality || '1080p';
                document.getElementById('SonarrServerUrl').value = config.SonarrServerUrl || '';
                document.getElementById('SonarrApiKey').value = config.SonarrApiKey || '';
                document.getElementById('RadarrServerUrl').value = config.RadarrServerUrl || '';
                document.getElementById('RadarrApiKey').value = config.RadarrApiKey || '';
                document.getElementById('ProwlarrServerUrl').value = config.ProwlarrServerUrl || '';
                document.getElementById('ProwlarrApiKey').value = config.ProwlarrApiKey || '';
                document.getElementById('MinSeeders').value = config.MinSeeders || 10;
                document.getElementById('BitPlayServerUrl').value = config.BitPlayServerUrl || 'http://localhost:3347';
                document.getElementById('EnableNotifications').checked = config.EnableNotifications || false;
                
                Dashboard.hideLoadingMsg();
            }).catch(function(error) {
                console.error('Error loading configuration:', error);
                Dashboard.hideLoadingMsg();
            });
        }

        function saveConfiguration() {
            Dashboard.showLoadingMsg();
            
            // Get form values
            var config = {
                EnableStreaming: document.getElementById('EnableStreaming').checked,
                EnableDownloads: document.getElementById('EnableDownloads').checked,
                TmdbApiKey: document.getElementById('TmdbApiKey').value,
                MaxSearchResults: parseInt(document.getElementById('MaxSearchResults').value) || 50,
                DefaultQuality: document.getElementById('DefaultQuality').value,
                SonarrServerUrl: document.getElementById('SonarrServerUrl').value,
                SonarrApiKey: document.getElementById('SonarrApiKey').value,
                RadarrServerUrl: document.getElementById('RadarrServerUrl').value,
                RadarrApiKey: document.getElementById('RadarrApiKey').value,
                ProwlarrServerUrl: document.getElementById('ProwlarrServerUrl').value,
                ProwlarrApiKey: document.getElementById('ProwlarrApiKey').value,
                MinSeeders: parseInt(document.getElementById('MinSeeders').value) || 10,
                BitPlayServerUrl: document.getElementById('BitPlayServerUrl').value,
                EnableNotifications: document.getElementById('EnableNotifications').checked
            };
            
            // Save configuration
            ApiClient.updatePluginConfiguration(JellyScoutConfigurationPage.pluginId, config).then(function() {
                Dashboard.hideLoadingMsg();
                Dashboard.alert('Settings saved successfully!');
            }).catch(function(error) {
                console.error('Error saving configuration:', error);
                Dashboard.hideLoadingMsg();
                Dashboard.alert('Error saving settings. Please try again.');
            });
        }

        // Configuration page object
        window.JellyScoutConfigurationPage = {
            pluginId: 'a8b4d8c6-3f2a-4d7e-9b1c-5e8f2a9d3c7b'
        };

        // Handle form submission
        document.getElementById('jellyscoutConfigForm').addEventListener('submit', function(e) {
            e.preventDefault();
            saveConfiguration();
            return false;
        });

        // Load page when DOM is ready
        document.addEventListener('DOMContentLoaded', function() {
            loadPage();
        });
    </script>
</body>
</html> 