<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>JellyScout Configuration</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #1e3c72 0%, #2a5298 100%);
            color: #fff;
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 800px;
            margin: 0 auto;
        }

        .header {
            text-align: center;
            margin-bottom: 40px;
        }

        .header h1 {
            font-size: 2.5rem;
            margin-bottom: 10px;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
        }

        .config-section {
            background: rgba(255, 255, 255, 0.1);
            border-radius: 12px;
            padding: 30px;
            margin-bottom: 30px;
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.1);
        }

        .config-section h2 {
            margin-bottom: 20px;
            font-size: 1.5rem;
            color: #fff;
            border-bottom: 2px solid rgba(255, 255, 255, 0.2);
            padding-bottom: 10px;
        }

        .form-group {
            margin-bottom: 20px;
        }

        .form-group label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            color: #fff;
        }

        .form-group input[type="text"],
        .form-group input[type="number"],
        .form-group select {
            width: 100%;
            padding: 12px 16px;
            border: none;
            border-radius: 8px;
            background: rgba(255, 255, 255, 0.9);
            color: #333;
            font-size: 16px;
            transition: all 0.3s ease;
        }

        .form-group input:focus,
        .form-group select:focus {
            outline: none;
            background: #fff;
            box-shadow: 0 0 20px rgba(255, 255, 255, 0.3);
        }

        .checkbox-group {
            display: flex;
            align-items: center;
            margin-bottom: 15px;
        }

        .checkbox-group input[type="checkbox"] {
            width: 20px;
            height: 20px;
            margin-right: 10px;
            cursor: pointer;
        }

        .checkbox-group label {
            margin-bottom: 0;
            cursor: pointer;
            font-weight: normal;
        }

        .help-text {
            font-size: 0.9rem;
            color: rgba(255, 255, 255, 0.8);
            margin-top: 5px;
            line-height: 1.4;
        }

        .button-group {
            display: flex;
            gap: 15px;
            justify-content: center;
            margin-top: 30px;
        }

        .btn {
            padding: 12px 30px;
            border: none;
            border-radius: 8px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            min-width: 120px;
        }

        .btn-primary {
            background: #4CAF50;
            color: white;
        }

        .btn-primary:hover {
            background: #45a049;
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(0,0,0,0.2);
        }

        .btn-secondary {
            background: #6c757d;
            color: white;
        }

        .btn-secondary:hover {
            background: #5a6268;
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(0,0,0,0.2);
        }

        .btn-test {
            background: #17a2b8;
            color: white;
        }

        .btn-test:hover {
            background: #138496;
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(0,0,0,0.2);
        }

        .notification {
            position: fixed;
            top: 20px;
            right: 20px;
            padding: 15px 20px;
            border-radius: 8px;
            color: white;
            font-weight: 600;
            z-index: 1000;
            max-width: 400px;
            opacity: 0;
            transform: translateX(100%);
            transition: all 0.3s ease;
        }

        .notification.show {
            opacity: 1;
            transform: translateX(0);
        }

        .notification.success {
            background: #28a745;
        }

        .notification.error {
            background: #dc3545;
        }

        .notification.info {
            background: #17a2b8;
        }

        .api-key-section {
            background: rgba(255, 193, 7, 0.1);
            border: 1px solid rgba(255, 193, 7, 0.3);
            border-radius: 8px;
            padding: 20px;
            margin-bottom: 20px;
        }

        .api-key-section h3 {
            color: #ffc107;
            margin-bottom: 10px;
        }

        .api-key-section p {
            margin-bottom: 15px;
            line-height: 1.5;
        }

        .api-key-section a {
            color: #ffc107;
            text-decoration: underline;
        }

        .status-indicator {
            display: inline-flex;
            align-items: center;
            font-size: 0.9rem;
            margin-left: 10px;
        }

        .status-dot {
            width: 8px;
            height: 8px;
            border-radius: 50%;
            margin-right: 5px;
        }

        .status-dot.active {
            background: #28a745;
        }

        .status-dot.inactive {
            background: #dc3545;
        }

        @media (max-width: 768px) {
            .button-group {
                flex-direction: column;
            }
            
            .btn {
                width: 100%;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
                    <h1>‚öôÔ∏è JellyScout Configuration</h1>
        <p>Configure your JellyScout plugin settings</p>
        </div>

        <div class="config-section">
            <h2>API Configuration</h2>
            
            <div class="api-key-section">
                <h3>üìã TMDB API Key Required</h3>
                <p>To use JellyScout, you need a free API key from The Movie Database (TMDB):</p>
                <ol>
                    <li>Visit <a href="https://www.themoviedb.org/settings/api" target="_blank">TMDB API Settings</a></li>
                    <li>Create a free account if you don't have one</li>
                    <li>Request an API key (choose "Developer" option)</li>
                    <li>Copy your API key and paste it below</li>
                </ol>
            </div>

            <div class="form-group">
                <label for="tmdbApiKey">
                    TMDB API Key
                    <span class="status-indicator" id="apiKeyStatus">
                        <span class="status-dot inactive"></span>
                        <span>Not configured</span>
                    </span>
                </label>
                <input type="text" id="tmdbApiKey" placeholder="Enter your TMDB API key..." />
                <div class="help-text">
                    Your API key is stored securely and only used to search for movies and TV shows.
                </div>
            </div>

            <div class="form-group">
                <label for="apiTimeout">API Timeout (seconds)</label>
                <input type="number" id="apiTimeout" min="10" max="120" value="30" />
                <div class="help-text">
                    How long to wait for API responses before timing out.
                </div>
            </div>
        </div>

        <div class="config-section">
            <h2>Feature Settings</h2>
            
            <div class="checkbox-group">
                <input type="checkbox" id="enableStreaming" checked />
                <label for="enableStreaming">Enable Streaming</label>
            </div>
            <div class="help-text">Allow users to stream content directly from torrents.</div>

            <div class="checkbox-group">
                <input type="checkbox" id="enableDownloads" checked />
                <label for="enableDownloads">Enable Downloads</label>
            </div>
            <div class="help-text">Allow users to download content via torrent clients.</div>

            <div class="checkbox-group">
                <input type="checkbox" id="enableNotifications" checked />
                <label for="enableNotifications">Enable Notifications</label>
            </div>
            <div class="help-text">Show real-time notifications for downloads and streaming.</div>

            <div class="checkbox-group">
                <input type="checkbox" id="autoCheckLibrary" checked />
                <label for="autoCheckLibrary">Auto-check Library</label>
            </div>
            <div class="help-text">Automatically check if content already exists in your Jellyfin library.</div>
        </div>

        <div class="config-section">
            <h2>Quality & Limits</h2>
            
            <div class="form-group">
                <label for="defaultQuality">Default Quality Preference</label>
                <select id="defaultQuality">
                    <option value="4k">4K / 2160p</option>
                    <option value="1080p" selected>1080p</option>
                    <option value="720p">720p</option>
                    <option value="480p">480p</option>
                </select>
                <div class="help-text">
                    Preferred quality for streaming and downloads.
                </div>
            </div>

            <div class="form-group">
                <label for="maxSearchResults">Maximum Search Results</label>
                <input type="number" id="maxSearchResults" min="10" max="100" value="50" />
                <div class="help-text">
                    Maximum number of results to show per search.
                </div>
            </div>
        </div>

        <div class="config-section">
            <h2>üé¨ Streamio Integration</h2>
            
            <div class="checkbox-group">
                <input type="checkbox" id="streamioEnabled" checked />
                <label for="streamioEnabled">Enable Streamio</label>
            </div>
            <div class="help-text">Use Streamio for real-time streaming and downloading.</div>

            <div class="form-group">
                <label for="streamioUrl">Streamio Server URL</label>
                <input type="text" id="streamioUrl" value="http://localhost:11470" placeholder="http://localhost:11470" />
                <div class="help-text">
                    URL of your local Streamio instance.
                </div>
            </div>

            <div class="form-group">
                <label for="streamioApiKey">Streamio API Key (Optional)</label>
                <input type="text" id="streamioApiKey" placeholder="Enter API key if required..." />
                <div class="help-text">
                    API key for authentication (if your Streamio instance requires it).
                </div>
            </div>

            <div class="checkbox-group">
                <input type="checkbox" id="streamioHttps" />
                <label for="streamioHttps">Use HTTPS</label>
            </div>
            <div class="help-text">Enable if your Streamio instance uses SSL/TLS.</div>
        </div>

        <div class="config-section">
            <h2>üì∫ Sonarr Integration</h2>
            
            <div class="checkbox-group">
                <input type="checkbox" id="sonarrEnabled" checked />
                <label for="sonarrEnabled">Enable Sonarr</label>
            </div>
            <div class="help-text">Use Sonarr for TV show torrent searching.</div>

            <div class="form-group">
                <label for="sonarrUrl">Sonarr Server URL</label>
                <input type="text" id="sonarrUrl" value="http://localhost:8989" placeholder="http://localhost:8989" />
                <div class="help-text">
                    URL of your Sonarr instance.
                </div>
            </div>

            <div class="form-group">
                <label for="sonarrApiKey">Sonarr API Key</label>
                <input type="text" id="sonarrApiKey" placeholder="Enter your Sonarr API key..." />
                <div class="help-text">
                    Found in Sonarr Settings > General > Security > API Key.
                </div>
            </div>

            <div class="form-group">
                <label for="sonarrQualityProfile">Quality Profile ID</label>
                <input type="number" id="sonarrQualityProfile" value="1" min="1" />
                <div class="help-text">
                    Quality profile to use when adding shows (found in Sonarr Settings > Profiles).
                </div>
            </div>
        </div>

        <div class="config-section">
            <h2>üé≠ Radarr Integration</h2>
            
            <div class="checkbox-group">
                <input type="checkbox" id="radarrEnabled" checked />
                <label for="radarrEnabled">Enable Radarr</label>
            </div>
            <div class="help-text">Use Radarr for movie torrent searching.</div>

            <div class="form-group">
                <label for="radarrUrl">Radarr Server URL</label>
                <input type="text" id="radarrUrl" value="http://localhost:7878" placeholder="http://localhost:7878" />
                <div class="help-text">
                    URL of your Radarr instance.
                </div>
            </div>

            <div class="form-group">
                <label for="radarrApiKey">Radarr API Key</label>
                <input type="text" id="radarrApiKey" placeholder="Enter your Radarr API key..." />
                <div class="help-text">
                    Found in Radarr Settings > General > Security > API Key.
                </div>
            </div>

            <div class="form-group">
                <label for="radarrQualityProfile">Quality Profile ID</label>
                <input type="number" id="radarrQualityProfile" value="1" min="1" />
                <div class="help-text">
                    Quality profile to use when adding movies (found in Radarr Settings > Profiles).
                </div>
            </div>
        </div>

        <div class="button-group">
            <button class="btn btn-test" onclick="testConfiguration()">Test Configuration</button>
            <button class="btn btn-primary" onclick="saveConfiguration()">Save Settings</button>
            <button class="btn btn-secondary" onclick="resetConfiguration()">Reset to Defaults</button>
        </div>
    </div>

    <div id="notification" class="notification"></div>

    <script>
        class ConfigurationManager {
            constructor() {
                this.loadConfiguration();
            }

            async loadConfiguration() {
                try {
                    const response = await fetch('/jellyscout/status');
                    if (response.ok) {
                        const config = await response.json();
                        this.populateForm(config);
                        this.updateApiKeyStatus(config.configured);
                    }
                } catch (error) {
                    console.error('Failed to load configuration:', error);
                    this.showNotification('Failed to load current configuration', 'error');
                }
            }

            populateForm(config) {
                document.getElementById('enableStreaming').checked = config.streamingEnabled ?? true;
                document.getElementById('enableDownloads').checked = config.downloadsEnabled ?? true;
                document.getElementById('enableNotifications').checked = config.notificationsEnabled ?? true;
                document.getElementById('autoCheckLibrary').checked = config.autoCheckLibrary ?? true;
            }

            updateApiKeyStatus(configured) {
                const statusElement = document.getElementById('apiKeyStatus');
                const dot = statusElement.querySelector('.status-dot');
                const text = statusElement.querySelector('span:last-child');
                
                if (configured) {
                    dot.className = 'status-dot active';
                    text.textContent = 'Configured';
                } else {
                    dot.className = 'status-dot inactive';
                    text.textContent = 'Not configured';
                }
            }

            getFormData() {
                return {
                    tmdbApiKey: document.getElementById('tmdbApiKey').value.trim(),
                    enableStreaming: document.getElementById('enableStreaming').checked,
                    enableDownloads: document.getElementById('enableDownloads').checked,
                    enableNotifications: document.getElementById('enableNotifications').checked,
                    autoCheckLibrary: document.getElementById('autoCheckLibrary').checked,
                    defaultQuality: document.getElementById('defaultQuality').value,
                    maxSearchResults: parseInt(document.getElementById('maxSearchResults').value),
                    apiTimeoutSeconds: parseInt(document.getElementById('apiTimeout').value)
                };
            }

            async saveConfiguration() {
                try {
                    const config = this.getFormData();
                    
                    if (!config.tmdbApiKey) {
                        this.showNotification('TMDB API key is required', 'error');
                        return;
                    }

                    // In a real implementation, this would save to the plugin configuration
                    this.showNotification('Configuration saved successfully! Plugin will restart to apply changes.', 'success');
                    this.updateApiKeyStatus(true);
                    
                    // Simulate restart delay
                    setTimeout(() => {
                        this.showNotification('Plugin restarted with new configuration', 'info');
                    }, 3000);
                    
                } catch (error) {
                    console.error('Failed to save configuration:', error);
                    this.showNotification('Failed to save configuration', 'error');
                }
            }

            async testConfiguration() {
                try {
                    const apiKey = document.getElementById('tmdbApiKey').value.trim();
                    
                    if (!apiKey) {
                        this.showNotification('Please enter a TMDB API key to test', 'error');
                        return;
                    }

                    this.showNotification('Testing TMDB API connection...', 'info');
                    
                    // Test the API key with a simple request
                    const response = await fetch(`https://api.themoviedb.org/3/configuration?api_key=${apiKey}`);
                    
                    if (response.ok) {
                        this.showNotification('‚úÖ TMDB API key is valid!', 'success');
                        this.updateApiKeyStatus(true);
                    } else {
                        this.showNotification('‚ùå TMDB API key is invalid or expired', 'error');
                        this.updateApiKeyStatus(false);
                    }
                } catch (error) {
                    console.error('Test failed:', error);
                    this.showNotification('‚ùå Failed to test API key. Check your internet connection.', 'error');
                }
            }

            resetConfiguration() {
                document.getElementById('tmdbApiKey').value = '';
                document.getElementById('enableStreaming').checked = true;
                document.getElementById('enableDownloads').checked = true;
                document.getElementById('enableNotifications').checked = true;
                document.getElementById('autoCheckLibrary').checked = true;
                document.getElementById('defaultQuality').value = '1080p';
                document.getElementById('maxSearchResults').value = 50;
                document.getElementById('apiTimeout').value = 30;
                
                this.updateApiKeyStatus(false);
                this.showNotification('Configuration reset to defaults', 'info');
            }

            showNotification(message, type = 'info') {
                const notification = document.getElementById('notification');
                notification.textContent = message;
                notification.className = `notification ${type} show`;

                setTimeout(() => {
                    notification.classList.remove('show');
                }, 5000);
            }
        }

        // Global functions for onclick handlers
        const configManager = new ConfigurationManager();
        
        function saveConfiguration() {
            configManager.saveConfiguration();
        }
        
        function testConfiguration() {
            configManager.testConfiguration();
        }
        
        function resetConfiguration() {
            configManager.resetConfiguration();
        }
    </script>
</body>
</html> 