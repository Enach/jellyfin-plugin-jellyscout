<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>JellyScout Configuration</title>
</head>
<body>
    <div data-role="page" class="page type-interior configurationPage" data-require="emby-input,emby-button,emby-select,emby-checkbox">
        <div data-role="content">
            <div class="content-primary">
                <form class="jellyscoutConfigForm">
                    <div class="sectionTitleContainer flex align-items-center">
                        <h2 class="sectionTitle">JellyScout Configuration</h2>
                    </div>
                    
                    <div class="checkboxContainer checkboxContainer-withDescription">
                        <label>
                            <input type="checkbox" is="emby-checkbox" id="EnableStreaming" />
                            <span>Enable Streaming</span>
                        </label>
                        <div class="fieldDescription">Allow users to stream content directly from torrents</div>
                    </div>
                    
                    <div class="checkboxContainer checkboxContainer-withDescription">
                        <label>
                            <input type="checkbox" is="emby-checkbox" id="EnableDownloads" />
                            <span>Enable Downloads</span>
                        </label>
                        <div class="fieldDescription">Allow users to download content via external services</div>
                    </div>
                    
                    <div class="inputContainer">
                        <label class="inputLabel inputLabelUnfocused" for="TmdbApiKey">TMDB API Key</label>
                        <input is="emby-input" type="text" id="TmdbApiKey" name="TmdbApiKey" />
                        <div class="fieldDescription">Get your free API key from <a href="https://www.themoviedb.org/settings/api" target="_blank">TMDB</a></div>
                    </div>
                    
                    <div class="inputContainer">
                        <label class="inputLabel inputLabelUnfocused" for="MaxSearchResults">Max Search Results</label>
                        <input is="emby-input" type="number" id="MaxSearchResults" name="MaxSearchResults" min="10" max="100" />
                        <div class="fieldDescription">Maximum number of search results to return (10-100)</div>
                    </div>
                    
                    <div class="selectContainer">
                        <label class="selectLabel" for="DefaultQuality">Default Quality</label>
                        <select is="emby-select" id="DefaultQuality" name="DefaultQuality">
                            <option value="480p">480p</option>
                            <option value="720p">720p</option>
                            <option value="1080p">1080p</option>
                            <option value="4K">4K</option>
                        </select>
                        <div class="fieldDescription">Default quality preference for streaming and downloads</div>
                    </div>
                    
                    <h3 class="sectionTitle">External Services</h3>
                    
                    <div class="inputContainer">
                        <label class="inputLabel inputLabelUnfocused" for="SonarrServerUrl">Sonarr Server URL</label>
                        <input is="emby-input" type="text" id="SonarrServerUrl" name="SonarrServerUrl" placeholder="http://localhost:8989" />
                        <div class="fieldDescription">URL of your Sonarr instance (optional)</div>
                    </div>
                    
                    <div class="inputContainer">
                        <label class="inputLabel inputLabelUnfocused" for="SonarrApiKey">Sonarr API Key</label>
                        <input is="emby-input" type="text" id="SonarrApiKey" name="SonarrApiKey" />
                        <div class="fieldDescription">Found in Sonarr Settings > General > Security (optional)</div>
                    </div>
                    
                    <div class="inputContainer">
                        <label class="inputLabel inputLabelUnfocused" for="RadarrServerUrl">Radarr Server URL</label>
                        <input is="emby-input" type="text" id="RadarrServerUrl" name="RadarrServerUrl" placeholder="http://localhost:7878" />
                        <div class="fieldDescription">URL of your Radarr instance (optional)</div>
                    </div>
                    
                    <div class="inputContainer">
                        <label class="inputLabel inputLabelUnfocused" for="RadarrApiKey">Radarr API Key</label>
                        <input is="emby-input" type="text" id="RadarrApiKey" name="RadarrApiKey" />
                        <div class="fieldDescription">Found in Radarr Settings > General > Security (optional)</div>
                    </div>
                    
                    <h3 class="sectionTitle">Streaming Services</h3>
                    
                    <div class="inputContainer">
                        <label class="inputLabel inputLabelUnfocused" for="ProwlarrServerUrl">Prowlarr Server URL</label>
                        <input is="emby-input" type="text" id="ProwlarrServerUrl" name="ProwlarrServerUrl" placeholder="http://localhost:9696" />
                        <div class="fieldDescription">URL of your Prowlarr instance for torrent search</div>
                    </div>
                    
                    <div class="inputContainer">
                        <label class="inputLabel inputLabelUnfocused" for="ProwlarrApiKey">Prowlarr API Key</label>
                        <input is="emby-input" type="password" id="ProwlarrApiKey" name="ProwlarrApiKey" />
                        <div class="fieldDescription">Found in Prowlarr Settings > General > Security (for streaming)</div>
                    </div>
                    
                    <div class="inputContainer">
                        <label class="inputLabel inputLabelUnfocused" for="MinSeeders">Minimum Seeders for Streaming</label>
                        <input is="emby-input" type="number" id="MinSeeders" name="MinSeeders" min="1" max="100" value="10" />
                        <div class="fieldDescription">Minimum number of seeders required to show streaming option</div>
                    </div>
                    
                    <div class="inputContainer">
                        <label class="inputLabel inputLabelUnfocused" for="BitPlayServerUrl">BitPlay Server URL</label>
                        <input is="emby-input" type="text" id="BitPlayServerUrl" name="BitPlayServerUrl" placeholder="http://localhost:3347" />
                        <div class="fieldDescription">URL of your BitPlay streaming server</div>
                    </div>
                    
                    <div class="checkboxContainer checkboxContainer-withDescription">
                        <label>
                            <input type="checkbox" is="emby-checkbox" id="EnableNotifications" />
                            <span>Enable Notifications</span>
                        </label>
                        <div class="fieldDescription">Show real-time notifications for downloads and streaming</div>
                    </div>
                    
                    <br />
                    <div>
                        <button is="emby-button" type="submit" class="raised button-submit block">
                            <span>Save</span>
                        </button>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <script type="text/javascript">
        // Simple configuration page using Jellyfin's built-in APIs
        (function () {
            const pluginId = "a8b4d8c6-3f2a-4d7e-9b1c-5e8f2a9d3c7b";

            function loadPage() {
                Dashboard.showLoadingMsg();

                ApiClient.getPluginConfiguration(pluginId).then(function (config) {
                    // Load configuration values
                    document.querySelector('#EnableStreaming').checked = config.EnableStreaming || false;
                    document.querySelector('#EnableDownloads').checked = config.EnableDownloads || false;
                    document.querySelector('#TmdbApiKey').value = config.TmdbApiKey || '';
                    document.querySelector('#MaxSearchResults').value = config.MaxSearchResults || 50;
                    document.querySelector('#DefaultQuality').value = config.DefaultQuality || '1080p';
                    document.querySelector('#EnableNotifications').checked = config.EnableNotifications || false;
                    
                    // Load external service configurations
                    if (config.SonarrConfig) {
                        document.querySelector('#SonarrServerUrl').value = config.SonarrConfig.ServerUrl || '';
                        document.querySelector('#SonarrApiKey').value = config.SonarrConfig.ApiKey || '';
                    }
                    
                    if (config.RadarrConfig) {
                        document.querySelector('#RadarrServerUrl').value = config.RadarrConfig.ServerUrl || '';
                        document.querySelector('#RadarrApiKey').value = config.RadarrConfig.ApiKey || '';
                    }
                    
                    // Load Prowlarr configuration
                    if (config.ProwlarrConfig) {
                        document.querySelector('#ProwlarrServerUrl').value = config.ProwlarrConfig.ServerUrl || '';
                        document.querySelector('#ProwlarrApiKey').value = config.ProwlarrConfig.ApiKey || '';
                        document.querySelector('#MinSeeders').value = config.ProwlarrConfig.MinSeeders || 10;
                    }
                    
                    // Load BitPlay configuration
                    if (config.BitPlayConfig) {
                        document.querySelector('#BitPlayServerUrl').value = config.BitPlayConfig.ServerUrl || 'http://localhost:3347';
                    }

                    Dashboard.hideLoadingMsg();
                });
            }

            function saveConfiguration() {
                Dashboard.showLoadingMsg();

                // Get current configuration
                ApiClient.getPluginConfiguration(pluginId).then(function (config) {
                    // Update configuration values
                    config.EnableStreaming = document.querySelector('#EnableStreaming').checked;
                    config.EnableDownloads = document.querySelector('#EnableDownloads').checked;
                    config.TmdbApiKey = document.querySelector('#TmdbApiKey').value;
                    config.MaxSearchResults = parseInt(document.querySelector('#MaxSearchResults').value) || 50;
                    config.DefaultQuality = document.querySelector('#DefaultQuality').value;
                    config.EnableNotifications = document.querySelector('#EnableNotifications').checked;
                    
                    // Update external service configurations
                    config.SonarrConfig = config.SonarrConfig || {};
                    config.SonarrConfig.ServerUrl = document.querySelector('#SonarrServerUrl').value;
                    config.SonarrConfig.ApiKey = document.querySelector('#SonarrApiKey').value;
                    config.SonarrConfig.Enabled = !!(config.SonarrConfig.ServerUrl && config.SonarrConfig.ApiKey);
                    
                    config.RadarrConfig = config.RadarrConfig || {};
                    config.RadarrConfig.ServerUrl = document.querySelector('#RadarrServerUrl').value;
                    config.RadarrConfig.ApiKey = document.querySelector('#RadarrApiKey').value;
                    config.RadarrConfig.Enabled = !!(config.RadarrConfig.ServerUrl && config.RadarrConfig.ApiKey);
                    
                    // Update Prowlarr configuration
                    config.ProwlarrConfig = config.ProwlarrConfig || {};
                    config.ProwlarrConfig.ServerUrl = document.querySelector('#ProwlarrServerUrl').value;
                    config.ProwlarrConfig.ApiKey = document.querySelector('#ProwlarrApiKey').value;
                    config.ProwlarrConfig.MinSeeders = parseInt(document.querySelector('#MinSeeders').value) || 10;
                    config.ProwlarrConfig.Enabled = !!(config.ProwlarrConfig.ServerUrl && config.ProwlarrConfig.ApiKey);
                    
                    // Update BitPlay configuration
                    config.BitPlayConfig = config.BitPlayConfig || {};
                    config.BitPlayConfig.ServerUrl = document.querySelector('#BitPlayServerUrl').value || 'http://localhost:3347';
                    config.BitPlayConfig.Enabled = !!(config.BitPlayConfig.ServerUrl);

                    // Save configuration
                    ApiClient.updatePluginConfiguration(pluginId, config).then(function () {
                        Dashboard.processPluginConfigurationUpdateResult();
                    });
                });
            }

            // Event listeners
            document.querySelector('.jellyscoutConfigForm').addEventListener('submit', function (e) {
                e.preventDefault();
                saveConfiguration();
                return false;
            });

            // Load page when ready
            pageClassOn('pageshow', "configurationPage", loadPage);
        })();
    </script>
</body>
</html> 